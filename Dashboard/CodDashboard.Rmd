---
title: "Código Dashboard"
Author: "Clàudia Hernández"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    social: menu
    source_code: embed
  runtime: shiny
  
---

```{r setup, include=FALSE}

library(flexdashboard)
library(tidyverse)
library(maps)
library(DT)
library(lorem)
library(ggplot2)
library(dplyr)
library(plotly)
library(mapdata)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(viridis)
library(rmapshaper)
library(geojsonio)
```

```{r}
datos <- read.csv("datosr2_depurado.csv", header=TRUE, sep=",")
```

```{r}

```

Gráficos {data-icon=fa-signal}
=========================================
Column {data-width=450}
-----------------------------------------------------------------------

### Casos de discriminación (2002-2023)

```{r}
#Filtro los datos porque la información sobre las personas no discriminadas no es interesante para el objetivo
datos$essround <- as.factor(datos$essround)
datos$discrimination <- as.factor(datos$discrimination)

datos_filtrados <- datos %>% filter(discrimination != "No discriminado")

#Cuento el número de casos por año y tipo de discriminación
datos_agg <- datos_filtrados %>%
  group_by(essround, discrimination) %>%
  summarise(count = n())

#Me aseguro de que ess round sea numérico para el gráfico de serie temporal
datos_agg$essround <- as.numeric(as.character(datos_agg$essround))

# Crear el gráfico de serie temporal
p <-ggplot(data = datos_agg, aes(x = essround, y = count, color = discrimination, group = discrimination)) +
  geom_line() +
  geom_point() +
  labs(title = "Evolución temporal de los casos de discriminación por tipo",
       x = "Año",
       y = "Número de casos",
       color = "Tipo de discriminación") +
  theme_minimal()

#Añado la interacción
p_interactive <- ggplotly(p) %>% 
  layout(legend = list(title = list(text = 'Tipo de discriminación')))

# Muestro el gráfico
p_interactive

```

Column {data-width=550}
-----------------------------------------------------------------------

### Discriminación por región

```{r fig.width=16, fig.height=10}




```


Tablas {data-icon=fa-table}
=========================================

```{r}
datatable(datos,
          caption= 'Datos Discriminación 2002-2023',
          rownames= T,
          filter= 'top',
          options= list(pageLength=25))
```


Acerca del estudio {data-icon=fa-globe}
========================================

Inputs{.sidebar data-height=400}
----------------
*'r ipsum(1)'*
